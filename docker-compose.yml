services:
  app:
    build: .
    container_name: app
    restart: always
    networks:
      - web
    labels:
      - 'traefik.enable=true'

      # glavni domen
      - 'traefik.http.routers.app.rule=Host(`securenet.rs`)'
      - 'traefik.http.routers.app.entrypoints=websecure'
      - 'traefik.http.routers.app.tls.certresolver=myresolver'

      # port na kojem app sluÅ¡a UNUTAR kontejnera
      - 'traefik.http.services.app.loadbalancer.server.port=3000'

      # www -> apex redirekcija
      - 'traefik.http.routers.www.rule=Host(`www.securenet.rs`)'
      - 'traefik.http.routers.www.entrypoints=websecure'
      - 'traefik.http.routers.www.tls.certresolver=myresolver'
      - 'traefik.http.routers.www.middlewares=redirect-to-apex@docker'
      - "traefik.http.middlewares.redirect-to-apex.redirectregex.regex=^https?://www\\.securenet\\.rs/(.*)"
      - 'traefik.http.middlewares.redirect-to-apex.redirectregex.replacement=https://securenet.rs/$$1'
      - 'traefik.http.middlewares.redirect-to-apex.redirectregex.permanent=true'

networks:
  web:
    external: true
